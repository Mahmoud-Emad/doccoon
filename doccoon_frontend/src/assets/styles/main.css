@import "tailwindcss";
@plugin "@tailwindcss/typography";

/* ============================================
   Theme Configuration (Tailwind v4)
   ============================================ */
@theme {
    --color-primary: #007acc;
    --color-primary-dark: #005a9e;
    --color-danger: #ff2339;
    --color-danger-dark: #c82333;

    --font-sans:
        -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica", "Arial",
        sans-serif;
    --font-mono:
        ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas,
        "Liberation Mono", monospace;

    --animate-spin: spin 1s linear infinite;
    --animate-fade-in: fadeIn 0.2s ease;
    --animate-slide-in: slideIn 0.3s ease;
    --animate-float: float 3s ease-in-out infinite;

    @keyframes spin {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    @keyframes slideIn {
        from {
            transform: translateY(-20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    @keyframes float {
        0%,
        100% {
            transform: translateY(0px);
        }
        50% {
            transform: translateY(-10px);
        }
    }
}

/* ============================================
   CSS Variables for Light/Dark Theme
   ============================================ */
:root {
    --bg-color: #ffffff;
    --page-bg: #ffffff;
    --text-color: #000000;
    --border-color: #e0e0e0;
    --separator-color: #e0e0e0;
    --separator-hover: #cccccc;
    --footer-bg: #007acc;
    --footer-border: #007acc;
    --footer-text: #ffffff;
    --footer-item-hover: #005a9e;
    --btn-bg: #000000;
    --btn-text: #ffffff;
    --btn-hover-bg: #333333;
    --btn-delete-bg: #ff2339;
    --btn-delete-hover: #ff2339;
    --scrollbar-track: #ffffff;
    --scrollbar-thumb: #e0e0e0;
    --scrollbar-thumb-hover: #cccccc;
    --code-bg: #f5f5f5;
    --table-header-bg: #f5f5f5;
    --placeholder-color: #888888;
    --modal-overlay: rgba(0, 0, 0, 0.5);
    --modal-bg: #ffffff;
    --modal-border: #e0e0e0;
    --section-alt-bg: #f5f5f7;
}

body.dark-theme {
    --bg-color: #1a1a1a;
    --page-bg: #2a2a2a;
    --text-color: #e0e0e0;
    --border-color: #404040;
    --separator-color: #404040;
    --separator-hover: #555555;
    --footer-bg: #007acc;
    --footer-border: #007acc;
    --footer-text: #ffffff;
    --footer-item-hover: #005a9e;
    --btn-bg: #ffffff;
    --btn-text: #000000;
    --btn-hover-bg: #cccccc;
    --btn-delete-bg: #dc3545;
    --btn-delete-hover: #c82333;
    --scrollbar-track: #2a2a2a;
    --scrollbar-thumb: #404040;
    --scrollbar-thumb-hover: #555555;
    --code-bg: #1a1a1a;
    --table-header-bg: #1a1a1a;
    --placeholder-color: #888888;
    --modal-overlay: rgba(0, 0, 0, 0.7);
    --modal-bg: #2a2a2a;
    --modal-border: #404040;
    --section-alt-bg: #222222;
}

/* ============================================
   Base Reset
   ============================================ */
@layer base {
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: var(--font-sans);
        background: var(--bg-color);
        height: 100vh;
        transition: background-color 0.3s ease;
    }

    ::selection {
        background: rgba(0, 0, 0, 0.1);
        color: #000000;
    }
}

/* ============================================
   Scrollbar
   ============================================ */
@layer base {
    .page::-webkit-scrollbar {
        width: 10px;
    }
    .page::-webkit-scrollbar-track {
        background: var(--scrollbar-track);
    }
    .page::-webkit-scrollbar-thumb {
        background: var(--scrollbar-thumb);
        border-radius: 5px;
        border: 2px solid var(--scrollbar-track);
    }
    .page::-webkit-scrollbar-thumb:hover {
        background: var(--scrollbar-thumb-hover);
    }
}

/* ============================================
   Markdown / Prose Rendering
   ============================================ */
@layer components {
    .page-view h1,
    .page-view h2,
    .page-view h3,
    .page-view h4,
    .page-view h5,
    .page-view h6 {
        margin-top: 24px;
        margin-bottom: 16px;
        font-weight: 600;
        line-height: 1.25;
    }
    .page-view h1 {
        font-size: 2em;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 8px;
    }
    .page-view h2 {
        font-size: 1.5em;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 8px;
    }
    .page-view h3 {
        font-size: 1.25em;
    }
    .page-view h4 {
        font-size: 1em;
    }
    .page-view h5 {
        font-size: 0.875em;
    }
    .page-view h6 {
        font-size: 0.85em;
        color: #666666;
    }
    .page-view p {
        margin-bottom: 16px;
    }
    .page-view ul,
    .page-view ol {
        margin-bottom: 16px;
        padding-left: 32px;
    }
    .page-view li {
        margin-bottom: 4px;
    }
    .page-view input[type="checkbox"] {
        margin-right: 8px;
    }
    .page-view ul.contains-task-list {
        list-style: none;
        padding-left: 24px;
    }
    .page-view .task-list-item {
        list-style: none;
    }
    .page-view code {
        background: var(--code-bg);
        padding: 2px 6px;
        border-radius: 3px;
        font-family: var(--font-mono);
        font-size: 85%;
        border: 1px solid var(--border-color);
    }
    .page-view pre {
        background: var(--code-bg);
        padding: 16px;
        overflow-x: auto;
        margin-bottom: 16px;
        border-radius: 6px;
        position: relative;
        border: 1px solid var(--border-color);
    }
    .page-view pre code {
        background: transparent;
        padding: 0;
        border: none;
        font-size: 13px;
        line-height: 1.5;
    }
    .page-view blockquote {
        border-left: 4px solid var(--border-color);
        padding-left: 16px;
        margin-left: 0;
        margin-bottom: 16px;
        color: var(--text-color);
        opacity: 0.7;
    }
    .page-view a {
        color: #0066cc;
        text-decoration: none;
    }
    .page-view a:hover {
        text-decoration: underline;
    }
    .page-view strong {
        font-weight: 600;
    }
    .page-view em {
        font-style: italic;
    }
    .page-view hr {
        border: none;
        border-top: 1px solid var(--border-color);
        margin: 24px 0;
    }
    .page-view table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 16px;
    }
    .page-view table th,
    .page-view table td {
        border: 1px solid var(--border-color);
        padding: 8px 12px;
        text-align: left;
    }
    .page-view table th {
        background: var(--table-header-bg);
        font-weight: 600;
    }
    .page-view img {
        max-width: 100%;
        height: auto;
    }
}

/* ============================================
   Code Copy Button (injected by useMarkdown)
   ============================================ */
@layer components {
    .code-copy-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 4px;
        padding: 6px 8px;
        cursor: pointer;
        opacity: 0;
        transition: all 0.2s ease;
        color: var(--text-color);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    body.dark-theme .code-copy-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .page-view pre:hover .code-copy-btn {
        opacity: 1;
    }
    .code-copy-btn:hover {
        background: rgba(0, 0, 0, 0.1);
    }
    body.dark-theme .code-copy-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    .code-copy-btn:active {
        transform: scale(0.95);
    }
    .code-copy-btn svg {
        display: block;
    }
}

/* ============================================
   Mermaid Diagrams
   ============================================ */
@layer components {
    .mermaid-diagram {
        margin: 16px 0;
        text-align: center;
    }
    .mermaid-diagram svg {
        max-width: 100%;
        height: auto;
    }
    body.dark-theme .mermaid-diagram svg text {
        fill: #c9d1d9 !important;
    }
    body.dark-theme .mermaid-diagram svg line {
        stroke: #8b949e !important;
    }
    body.dark-theme .mermaid-diagram svg path {
        stroke: #8b949e !important;
    }
    body.dark-theme .mermaid-diagram svg rect {
        stroke: #8b949e !important;
    }
    body.dark-theme .mermaid-diagram svg polygon {
        stroke: #8b949e !important;
    }
    body.dark-theme .mermaid-diagram svg circle {
        stroke: #8b949e !important;
    }
}

/* ============================================
   KaTeX Math
   ============================================ */
@layer components {
    .page-view .katex {
        font-size: 1.1em;
    }
    .page-view .katex-display {
        margin: 20px 0;
        overflow-x: auto;
        overflow-y: hidden;
        padding: 10px 0;
    }
    .page-view .katex-display > .katex {
        text-align: center;
        display: block;
    }
    body.dark-theme .page-view .katex {
        color: var(--text-color);
    }
    body.dark-theme .page-view .katex .mord,
    body.dark-theme .page-view .katex .mbin,
    body.dark-theme .page-view .katex .mrel,
    body.dark-theme .page-view .katex .mop,
    body.dark-theme .page-view .katex .mopen,
    body.dark-theme .page-view .katex .mclose,
    body.dark-theme .page-view .katex .mpunct,
    body.dark-theme .page-view .katex .minner {
        color: var(--text-color);
    }
    .katex {
        font-size: 1.1em;
    }
    .katex-display {
        margin: 1.5em 0;
        overflow-x: auto;
        overflow-y: hidden;
    }
    body.dark-theme .katex {
        color: var(--text-color);
    }
    body.dark-theme .katex .mord,
    body.dark-theme .katex .mbin,
    body.dark-theme .katex .mrel,
    body.dark-theme .katex .mop,
    body.dark-theme .katex .mpunct,
    body.dark-theme .katex .mopen,
    body.dark-theme .katex .mclose,
    body.dark-theme .katex .minner {
        color: var(--text-color);
    }
    .katex-html {
        white-space: normal;
    }
    .katex-display > .katex {
        white-space: normal;
    }
    .katex-display > .katex > .katex-html {
        display: block;
        text-align: center;
    }
}

/* ============================================
   Diff Highlighting (injected by useDiff)
   ============================================ */
@layer components {
    .diff-line {
        padding: 2px 8px;
        font-family: var(--font-mono);
        font-size: 13px;
        line-height: 1.5;
        white-space: pre-wrap;
        word-break: break-word;
    }
    .diff-line-added {
        background: #e6ffed;
        border-left: 3px solid #28a745;
        color: #24292f;
    }
    .diff-line-removed {
        background: #ffeef0;
        border-left: 3px solid #dc3545;
        color: #24292f;
    }
    .diff-line-unchanged {
        border-left: 3px solid transparent;
        color: var(--text-color);
    }
    .diff-line-placeholder {
        background: #f5f5f5;
        border-left: 3px solid #d0d0d0;
        opacity: 0.5;
        min-height: 1.5em;
    }
    body.dark-theme .diff-line-added {
        background: #1e4620;
        border-left-color: #3fb950;
        color: #c9d1d9;
    }
    body.dark-theme .diff-line-removed {
        background: #4a1c1c;
        border-left-color: #f85149;
        color: #c9d1d9;
    }
    body.dark-theme .diff-line-placeholder {
        background: #2a2a2a;
        border-left-color: #404040;
    }
}

/* ============================================
   Highlight.js Dark Theme Overrides
   Note: These must be outside @layer to override CDN stylesheets
   ============================================ */
/* Force dark background on code blocks in dark mode */
body.dark-theme .page-view pre,
body.dark-theme .page-view pre code,
body.dark-theme pre.hljs,
body.dark-theme code.hljs,
body.dark-theme .hljs {
    background: var(--code-bg) !important;
    color: #c9d1d9 !important;
}
body.dark-theme .hljs-keyword,
body.dark-theme .hljs-selector-tag,
body.dark-theme .hljs-literal,
body.dark-theme .hljs-section,
body.dark-theme .hljs-link {
    color: #ff7b72 !important;
}
body.dark-theme .hljs-function .hljs-keyword {
    color: #d2a8ff !important;
}
body.dark-theme .hljs-subst {
    color: #c9d1d9 !important;
}
body.dark-theme .hljs-string,
body.dark-theme .hljs-title,
body.dark-theme .hljs-name,
body.dark-theme .hljs-type,
body.dark-theme .hljs-attribute,
body.dark-theme .hljs-symbol,
body.dark-theme .hljs-bullet,
body.dark-theme .hljs-addition,
body.dark-theme .hljs-variable,
body.dark-theme .hljs-template-tag,
body.dark-theme .hljs-template-variable {
    color: #a5d6ff !important;
}
body.dark-theme .hljs-comment,
body.dark-theme .hljs-quote,
body.dark-theme .hljs-deletion,
body.dark-theme .hljs-meta {
    color: #8b949e !important;
}
body.dark-theme .hljs-doctag,
body.dark-theme .hljs-strong {
    font-weight: bold;
}
body.dark-theme .hljs-emphasis {
    font-style: italic;
}
body.dark-theme .hljs-number {
    color: #79c0ff !important;
}
body.dark-theme .hljs-built_in,
body.dark-theme .hljs-class .hljs-title {
    color: #ffa657 !important;
}
/* Additional token types for comprehensive coverage */
body.dark-theme .hljs-params {
    color: #c9d1d9 !important;
}
body.dark-theme .hljs-property {
    color: #79c0ff !important;
}
body.dark-theme .hljs-punctuation {
    color: #c9d1d9 !important;
}
body.dark-theme .hljs-operator {
    color: #ff7b72 !important;
}
body.dark-theme .hljs-regexp {
    color: #7ee787 !important;
}
body.dark-theme .hljs-selector-class,
body.dark-theme .hljs-selector-id {
    color: #7ee787 !important;
}
body.dark-theme .hljs-tag {
    color: #7ee787 !important;
}
body.dark-theme .hljs-attr {
    color: #79c0ff !important;
}

/* ============================================
   Sequence diagram text fix
   ============================================ */
text .messageText {
    color: red !important;
}
